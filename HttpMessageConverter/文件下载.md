---
up:
  - "[[Spring MVC 課程描述]]"
  - "[[HttpMessageConverter]]"
  - "[[ResponseEntity]]"
---
后台测试代码

```java
@Controller
@RequestMapping("/fileUploadDownloadController")
public class FileUploadDownloadController {
    @GetMapping("/testDownload")
    public ResponseEntity<byte[]> testDownload(HttpSession session) {
        ServletContext context = session.getServletContext();
        // 文件位置和名称
        final String path = "/static/img/";
        String fileName = "1.png";
        // 响应体
        String realPath = context.getRealPath(path + fileName);
        byte[] bytes = readFile(realPath);
        // 响应头
        MultiValueMap<String, String> headers = new HttpHeaders();
        headers.set("Content-Disposition", "attachment;filename=" + fileName);
        // 响应状态码
        HttpStatus status = HttpStatus.OK;
        // 响应实体
        return new ResponseEntity<>(bytes, headers, status);
    }

    /**
     * 读取文件流
     *
     * @param realPath
     * @return
     */
    private byte[] readFile(String realPath) {
        System.out.println(realPath);
        final int initSize = 0;
        byte[] bytes = new byte[initSize];
        try (BufferedInputStream bis = new BufferedInputStream(new FileInputStream(realPath));) {
            bytes = new byte[bis.available()];
            bis.read(bytes);
        } catch (IOException e) {
            e.printStackTrace();
        }
        return bytes;
    }
}
```

前台测试代码

```html
<a th:href="@{/fileUploadDownloadController/testDownload}">测试下载文件</a>
```

测试效果

![[1755508001254_ZGCbQgk2mm.gif]]

