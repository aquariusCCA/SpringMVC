> SpringMVC 中的拦截器用于拦截控制器方法的执行，需要实现`HandlerInterceptor`，并在 SpringMVC 的配置文件中进行配置

# 方式一

后台测试代码

```java
public class MyInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("MyInterceptor==>preHandle");
        return HandlerInterceptor.super.preHandle(request, response, handler);
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println("MyInterceptor==>postHandle");
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println("MyInterceptor==>afterCompletion");
        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
    }
}
```

配置拦截器

```xml
<mvc:interceptors>
    <bean id="myInterceptor" class="com.vectorx.springmvc.s00_helloworld.interceptor.MyInterceptor"></bean>
</mvc:interceptors>
```

访问任意路径，后台日志信息

```shell
MyInterceptor==>preHandle
MyInterceptor==>postHandle
MyInterceptor==>afterCompletion
```

---
# 方式二

后台测试代码

```java
@Component
public class MyInterceptor implements HandlerInterceptor {
    // 略同
}
```

配置拦截器

```xml
<mvc:interceptors>
    <ref bean="myInterceptor"></ref>
</mvc:interceptors>
```

访问任意路径，后台日志信息

```shell
MyInterceptor==>preHandle
MyInterceptor==>postHandle
MyInterceptor==>afterCompletion
```

---
# 方式三

后台测试代码

```java
@Component
public class MyInterceptor implements HandlerInterceptor {
    // 略同
}
```

配置拦截器

```xml
<mvc:interceptors>
    <mvc:interceptor>
        <mvc:mapping path="/**"/>
        <mvc:exclude-mapping path="/"/>
        <ref bean="myInterceptor"></ref>
    </mvc:interceptor>
</mvc:interceptors>
```

此时除了访问`/`即首页时不会走拦截器，其他请求都会走拦截器，其后台日志信息

```shell
MyInterceptor==>preHandle
MyInterceptor==>postHandle
MyInterceptor==>afterCompletion
```

> **注意**：这里的`path`路径配置的是`/**`，表示任意层路径的请求，符合`Ant`风格的路径。这与`web.xml`中`url-pattern`的`/*`匹配效果一致，但写法不同

---

# 小结

- 方式一和方式二都是对`DispatcherServlet`所处理的所有请求进行拦截
- 方式三可以有选择拦截请求，通过`ref`或`bean`设置拦截器，通过`mvc:mapping`设置需要拦截的请求，通过`mvc:exclude-mapping`设置需要排除（即不需要拦截）的请求

---